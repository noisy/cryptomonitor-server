var request = require("request"),
  stringify = require("querystring").stringify
  url = 'https://poloniex.com/public';

function Poloniex() {}

Poloniex._apiQuery = function(method, args, callback) {
  args.command = method;

  var options = {
    uri: url + "?" + stringify(args),
    agent: false,
    method: 'GET',
    headers: {
      "User-Agent": "Mozilla/4.0 (compatible; CoinedUp API node client)",
      "Content-type": "application/x-www-form-urlencoded"
    },
    "rejectUnauthorized": false
  };

  request(options, function(err, res, body) {
    try {
      var response = JSON.parse(body);
      if(typeof callback == typeof Function)
        callback(response);
    } catch(e) {
      console.log(e);
    }
  });
}

Poloniex.ticker = function(callback) {
  Poloniex._apiQuery('returnTicker', {}, callback);
}

Poloniex.dayVolume = function(callback) {
  Poloniex._apiQuery('return24Volume', {}, callback);
}

Poloniex.orderbook = function(market, callback) {
  Poloniex._apiQuery('returnOrderBook', { currencyPair: market }, callback);
}

Poloniex.trades = function(market, callback) {
  Poloniex._apiQuery('returnTradeHistory', { currencyPair: market }, callback);
}

module.exports = Poloniex;